<!--html-->
<html>
    <head>
        <title>Q View</title>
        <link rel="stylesheet" type="text/css" href="style.css">

        <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
        <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    </head>

    <body>

        <h1>NFT Viewer</h1>

        <button id="btn" onclick="login()">Login with MetaMask</button>
        
        <script>
            Moralis.initialize("BAwvbMiToQr1JICUrf4Tm2b4y6IJInP2DpWLGXMa");
            Moralis.serverURL = "https://xfwseoyfgpul.usemoralis.com:2053/server";

            async function login() {
                console.log("Login Clicked")
                var user = await Moralis.Web3.authenticate({ signingMessage: "Q's Dapp"});
                if(user) {
                    console.log(user)
                }
                else {
                alert("No ETH brower extension detected.");
                }

                window.userAddress = window.localStorage.getItem("userAddress");
                showAddress();

            };

            // Use this function to turn a 42 character ETH address
            // into an address like 0x345...12345
            function truncateAddress(address) {
              if (!address) {
                return "";
              }
              return `${address.substr(0, 5)}...${address.substr(
                address.length - 5,
                address.length
              )}`;
            }

            // Display or remove the users know address on the frontend
            function showAddress() {
              if (!window.userAddress) {
                document.getElementById("userAddress").innerText = "";
                document.getElementById("logoutButton").classList.add("hidden");
                return false;
              }

              document.getElementById(
                "userAddress"
              ).innerText = `ETH Address: ${truncateAddress(window.userAddress)}`;
              document.getElementById("logoutButton").classList.remove("hidden");
            }

            // remove stored user address and reset frontend
            function logout() {
              window.userAddress = null;
              window.localStorage.removeItem("userAddress");
              showAddress();
            }
        </script>
    </body>
    
</html>
