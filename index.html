<!--html-->
<html>
    <head>
        <title>Q View</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <meta http-equiv="Cache-control" content="no-cache">
        <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
        <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    </head>

    <body>

        <h1>NFT Viewer</h1>

        <button id="btn" onclick="login()">Login with MetaMask</button>

        <button id="btn" onclick="getNFTs()">View NFT's</button>

        <div id="NFTcanvas" class="table-responsive d-flex flex-wrap">

        </div>
        
        <script>
            const serverUrl = "https://xfwseoyfgpul.usemoralis.com:2053/server";
            const appId = "BAwvbMiToQr1JICUrf4Tm2b4y6IJInP2DpWLGXMa";
            Moralis.start({ serverUrl, appId });
            
            async function login() {
                console.log("Login Clicked")
                var user = await Moralis.authenticate({ signingMessage: "Q's Dapp"});
                if(user) {
                    console.log(user.get('ethAddress'))
                }
                else {
                alert("No ETH brower extension detected.");
                }
            }

            async function getNFTs() {
                console.log("Get NFTs")
                // get NFTs for current user on Mainnet
                let nfts = await Moralis.Web3API.account.getNFTs({ chain: 'mainnet' });
                console.log(nfts)
                let NFTcanvas = document.querySelector('#NFTcanvas');

                if(nfts.result.length > 0) {
                    nfts.result.forEach(n => {
                        let metadata = JSON.parse(n.metadata);
                        let content = `
                        <div class="card col-md-3" >
                            <img src="${metadata.image_url}" class="card-img-top" height=300>
                            <div class="card-body">
                                <h5 class="card-title">${metadata.name}</h5>
                                <p class="card-text">${metadata.description}</p>
                            </div>
                        </div>
                        `
                        NFTcanvas.innerHTML += content;
                    })
                }  
            }

            // fixURL = (url) => {
            //     if (url.startsWith("ipfs")) {
            //         return "https://ipfs.moralis.io:2053/ipfs/" + url.split("ipfs://").slice(-1)
            //     }
            //     else {
            //         return url + "?format=json"
            //     }
            // }

        </script>
    </body>
</html>
